{% extends 'base.html' %}
{% load static %}

{% block title %}Oahu Hiking Directory{% endblock title %}
{% block content %}

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
crossorigin=""/>

<link
  rel="stylesheet"
  href="https://use.fontawesome.com/releases/v5.11.2/css/all.css"
/>

<!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
crossorigin=""></script>

<script src="{% static 'js/trailMapPage.js' %}"></script>

<div class="absolute flex h-full w-full bg-white">
    <div id='hike-list' class="p-4 flex-auto flex-col-1 flex-row-auto w-1/3 h-full overflow-y-auto space-y-4 bg-gray-50">  
        <div class = "flex w-full h-auto flex-row-1 space-x-3 bg-gray-50 justify-left">
            <div class = "flex w-auto h-auto flex-row-1 justify-left">
                <div class = "flex w-full h-auto flex-col-1 space-x-2">
                    <ul class="flex justify-left">
                        <i class="fas fa-grip-vertical py-1"></i>
                    </ul>
                    <p> Sort By </p>
                    <select name="sort" id="sort"></select>
                </div>
            </div>
            <div class = "flex w-1/2 h-auto flex-row-1 space-x justify-left">
                <div class = "flex w-full h-auto flex-col-1 space-x-2">
                    <ul class="flex justify-left">
                        <i class="fas fa-filter py-1"></i>
                    </ul>
                    <p> Filters </p>
                    <select name="filter" id="filter"></select>
                </div>
            </div>
        </div>

    {% for hike in hike_list %}
    <button onclick="open_menu('{{hike.id}}', '{{hike.hike_name}}', '{{hike.hike_difficulty}}', '{{hike.hike_traffic}}', '{{ hike.hike_images }}');" class="transition-all duration-200 ease-in-out w-full h-auto bg-white border-4 border-white rounded-md px-3 hover:border-white-100 shadow hover:border-blue-500 text-left">
        <div class="flex flex-row-1 space-x-3 justify-right">
            <h><b> {{ hike.hike_name }} </b></h>
        </div> 
        <div class="flex flex-row-1 space-x-3">
            <p> Average Rating </p>
            <ul class="flex justify-center">                        
                <li class="flex justify-center space-x-2" id="{{hike.id}}-rating">                
                </li>
            </ul>
            <script> 
                add_stars('{{hike.id}}-rating','{{hike.hike_rating}}')
            </script>
        </div>
        <div class="flex flex-row-1 space-x-2">
            <i class="fas fa-hiking justify-center py-1"></i> 
            <p class="bg-gray-100 px-2 rounded-md"> 3km / 30min</p>   
            <h class="rounded-md border border-gray-100 bg-gray-100 px-2">Difficulty: {{hike.hike_difficulty}} / 5 </h>
        </div>
        <div class="flex flex-row-1 space-x-3">
            {% if hike.hike_traffic == 5 %}
            <p> Heavy Traffic </p>
            {% endif %} 
            {% if hike.hike_traffic == 4 %}
            <p> Heavy-to-Moderate Traffic </p>
            {% endif %}
            {% if hike.hike_traffic == 3 %}
            <p> Moderate Traffic </p>
            {% endif %}
            {% if hike.hike_traffic == 2 %}
            <p> Moderate-to-Light Traffic </p>
            {% endif %} 
            {% if hike.hike_traffic == 1 %}
            <p> Light Traffic </p>
            {% endif %}
            
            <ul class="flex justify-center">                        
                <li class="flex justify-center space-x-2" id="{{hike.id}}-traffic">                
                </li>
            </ul>
            <script>add_cars("{{hike.id}}-traffic","{{hike.hike_traffic}}")</script>
        </div>
    </button>
    {% endfor %}
    </div>    
            
    <div id='hike-popout' class="transition-transform flex flex-col w-1/3 hidden border-4 border-white px-3">
        <div class="flex flex-col-auto w-full">
            <button onclick="open_list()" class="hover:border-3 rounded-md w-10 h-10 flex flex-row " >
                <i class="py-2 fas fa-arrow-left fa-lg"></i>
            </button>
        </div>
        <div id="hike-popout-info" class="flex flex-col flex-row-1 w-full h-full">
            <div id="hike-info" class="flex flex-col justify-center">
                <div class='flex justify-center py-3'>
                    <h1 id="hike_title" class="text-2xl font-bold text-center"> </h1>
                </div>
                <div class='flex justify-center rounded-full py-3'>
                    <img id="hike_image" class="w-full h-full" src="">
                </div>
                <div class='flex justify-center'>
                    <ul class="flex justify-center space-x-2">                        
                        <li class="flex justify-center space-x-2" id="hike_rating">                
                        </li>
                    </ul>
                </div>
                <div class='flex justify-center'>   
                    <h id="hike_difficulty" class="rounded-md border border-gray-100 bg-gray-100 px-2"></h>
                </div>
                <div class='flex justify-center'>
                    <ul class="flex justify-center space-x-2">                        
                        <li class="flex justify-center space-x-2" id="hike_traffic">                
                        </li>
                    </ul>
                </div>
                <div id="hike_description" class='flex justify-center'>
                    <p class="text-center"> </p>
                </div>
            </div>
        </div>            
    </div>

    
    <div class="p-4 flex-auto w-full h-full">
        <div id="map" class="h-full w-full"></div>
    </div>
</div>
<style>
    /* css to customize Leaflet default styles  */
    .popupCustom .leaflet-popup-tip,
    .popupCustom .leaflet-popup-content-wrapper {
        background: #097969;
        color: #e0e0e0;
        font-weight: bold;
        font-size: 15px;
    }
</style>
<script src="{% static 'js/trails.js' %}"></script>
<script>        
        var mymap = L.map('map', {
            renderer: L.canvas({ tolerance: 15 })
        }).setView([21.31526, -157.82861], 15);
        
        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/outdoors-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoiYWFrZW1vdG8iLCJhIjoiY2t2bHF1eGVhOWZtdDJwcGdwZWtoMmQ3bCJ9.l2t-FRs7-6a6G3MPgTfowg'
        }).addTo(mymap);

        var customOptions =
            {
                'maxWidth': '400',
                'width': '200',
                'className' : 'popupCustom'
            }

        var greenIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
            });


        function onEachFeature(feature, layer) {
            // does this feature have a property named popupContent?
            if (feature.properties && feature.properties.Trailname && feature.properties.TRAFFIC) {
                layer.bindPopup(feature.properties.Trailname, customOptions);
            }
            if (feature.properties && feature.geometry.type == "LineString"){
                var startCoords = feature.geometry.coordinates[0];
            }
            if (feature.properties && feature.geometry.type == "MultiLineString"){
                var startCoords = feature.geometry.coordinates[0][0];
            }
            console.log(startCoords)
            var trailhead = L.marker([startCoords[1],startCoords[0]], {icon: greenIcon}).addTo(mymap);
            trailhead.bindPopup(feature.properties.Trailname + "<br><center>Trailhead", customOptions);
        }

        L.geoJSON(Trails, {
            style: function(features){
                switch (features.properties.TRAFFIC) {
                    case 'HEAVY': return {color: "#ff0000", weight: 5, opacity: 0.7};
                    case 'MEDIUM': return {color: "#FFC300", weight: 5, opacity: 0.7};
                    case 'LIGHT':   return {color: "#50C878", weight: 5, opacity: 0.7};
                }

            },
            onEachFeature: onEachFeature
        }).addTo(mymap);
</script>

{% endblock content %}